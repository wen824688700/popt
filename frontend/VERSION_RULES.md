# 版本号规则说明

## 版本号格式
版本号采用 `主版本号.次版本号` 的格式，例如：`1.0`, `1.1`, `2.0`

## 版本号递增规则

### 1. 优化生成（optimize）- 次版本号递增
当用户点击"重新生成"按钮，通过 AI 优化生成新内容时：
- **次版本号递增**
- 主版本号保持不变
- 示例：`1.0` → `1.1` → `1.2` → `1.3`

**使用场景**：
- 在编辑器中修改内容后点击"重新生成"
- 迭代优化提示词
- 基于当前版本进行改进

### 2. 手动保存（save）- 主版本号递增
当用户在输出区点击"保存"按钮，手动保存当前版本时：
- **主版本号递增**
- 次版本号重置为 0
- 示例：`1.3` → `2.0` → `3.0` → `4.0`

**使用场景**：
- 对当前版本满意，想要保存为里程碑版本
- 标记重要的版本节点
- 区分不同的优化方向

## 版本号编辑

### 可编辑性
- 所有版本号都支持用户自定义编辑
- 点击版本号旁边的编辑图标（铅笔图标）进入编辑模式
- 支持任意格式的版本号（如 `v1.0`, `初稿`, `最终版` 等）

### 编辑操作
1. **进入编辑模式**：点击版本号旁边的编辑图标
2. **修改版本号**：在输入框中输入新的版本号
3. **保存修改**：
   - 按 `Enter` 键保存
   - 点击绿色勾选图标保存
4. **取消修改**：
   - 按 `Esc` 键取消
   - 点击红色叉号图标取消

### 编辑限制
- 编辑模式下，版本卡片不可点击选择
- 版本号不能为空
- 建议使用有意义的版本号便于识别

## 版本类型标识

### 优化生成（optimize）
- 标签颜色：紫色
- 标签文字：优化生成
- 自动生成的版本

### 手动保存（save）
- 标签颜色：灰色
- 标签文字：手动保存
- 用户主动保存的版本

## 示例场景

### 场景 1：迭代优化
```
1.0 (初始生成) → 优化生成
1.1 (添加细节) → 优化生成
1.2 (调整语气) → 优化生成
2.0 (满意版本) → 手动保存
```

### 场景 2：多方向尝试
```
1.0 (初始生成) → 优化生成
1.1 (方向A) → 优化生成
2.0 (保存方向A) → 手动保存
2.1 (尝试方向B) → 优化生成
3.0 (保存方向B) → 手动保存
```

### 场景 3：自定义版本号
```
1.0 → 编辑为 "初稿"
1.1 → 编辑为 "修订版"
2.0 → 编辑为 "最终版"
```

## 技术实现

### 版本号计算逻辑
```typescript
const getNextVersionNumber = (type: 'save' | 'optimize'): string => {
  if (versions.length === 0) return '1.0';
  
  const latestVersion = versions[0]; // 最新版本
  const [major, minor] = latestVersion.versionNumber.split('.').map(Number);
  
  if (type === 'optimize') {
    // 优化生成：小版本号递增
    return `${major}.${minor + 1}`;
  } else {
    // 手动保存：大版本号递增
    return `${major + 1}.0`;
  }
};
```

### 数据结构
```typescript
interface Version {
  id: string;                    // 唯一标识
  content: string;               // 版本内容
  type: 'save' | 'optimize';     // 版本类型
  createdAt: string;             // 创建时间
  description?: string;          // 版本描述
  versionNumber: string;         // 版本号（可编辑）
}
```

## 注意事项

1. **版本号唯一性**：系统不强制版本号唯一，但建议用户使用不同的版本号以便区分
2. **版本排序**：版本列表按创建时间倒序排列，最新的版本在最上面
3. **版本对比**：选择两个版本时，会显示版本号进行对比
4. **版本恢复**：恢复到某个版本不会改变该版本的版本号
